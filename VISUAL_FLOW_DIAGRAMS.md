# NBDFinder - Visual Flow Diagrams and Architecture

## Master Processing Flow

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                            NBDFinder Pipeline                               ║
║                        Non-B DNA Motif Detection                            ║
╚══════════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────────────────┐
    │                              INPUT LAYER                                │
    │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐  │
    │  │ FASTA Files │   │   Raw DNA   │   │   Batch     │   │   API       │  │
    │  │   (.fasta)  │   │  Sequences  │   │  Processing │   │  Requests   │  │
    │  └─────────────┘   └─────────────┘   └─────────────┘   └─────────────┘  │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │ Validation & Sanitization
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                        HYPERSCAN ENGINE                                 │
    │  ┌─────────────────────────────────────────────────────────────────┐    │
    │  │              Intel Hyperscan Database                          │    │
    │  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐      │    │
    │  │  │  Class 1  │ │  Class 2  │ │  Class 3  │ │  Class 4  │ ...  │    │
    │  │  │ Patterns  │ │ Patterns  │ │ Patterns  │ │ Patterns  │      │    │
    │  │  └───────────┘ └───────────┘ └───────────┘ └───────────┘      │    │
    │  └─────────────────────────────────────────────────────────────────┘    │
    │                         Ultra-Fast Pattern Matching                     │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │ Raw Pattern Matches
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                    CLASS-SPECIFIC DETECTION                             │
    │                                                                         │
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
    │  │Class 1  │  │Class 2  │  │Class 3  │  │Class 4  │  │Class 5  │      │
    │  │Curved   │  │Slipped  │  │Cruciform│  │R-Loop   │  │Triplex  │      │
    │  │DNA      │  │DNA      │  │DNA      │  │         │  │DNA      │      │
    │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘      │
    │                                                                         │
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
    │  │Class 6  │  │Class 7  │  │Class 8  │  │Class 9  │  │Class 10 │      │
    │  │G-Quad   │  │i-Motif  │  │Z-DNA    │  │Hybrid   │  │Cluster  │      │
    │  │(7 sub)  │  │(3 sub)  │  │(2 sub)  │  │         │  │         │      │
    │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘      │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │ Candidate Motifs
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                      SCIENTIFIC SCORING                                 │
    │                                                                         │
    │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │
    │ │  G4Hunter   │ │  Z-seeker   │ │ Curvature   │ │ Instability │       │
    │ │ Algorithm   │ │ Algorithm   │ │  Analysis   │ │   Scoring   │  ...  │
    │ │ (Bedrat16)  │ │  (Ho86)     │ │ (Olson98)   │ │ (Mirkin07)  │       │
    │ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘       │
    │                                                                         │
    │           Literature-Validated Scoring Methods                          │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │ Raw Scores
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                     BIOLOGICAL FILTERING                                │
    │                                                                         │
    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
    │  │   Length        │  │   Score         │  │   Sequence      │        │
    │  │ Constraints     │  │ Thresholds      │  │   Quality       │        │
    │  │ (S_min/S_max)   │  │ (Class-specific)│  │   Control       │        │
    │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │
    │                                                                         │
    │              Biological Relevance Validation                            │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │ Validated Motifs
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                     MOTIF STANDARDIZATION                               │
    │                                                                         │
    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
    │  │  Coordinate     │  │   Motif ID      │  │     Score       │        │
    │  │ Standardization │  │  Generation     │  │ Normalization   │        │
    │  │   (1-based)     │  │   (Unique)      │  │    [0,1]        │        │
    │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │
    │                                                                         │
    │           Consistent Output Schema Formation                             │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │ Standardized Motifs
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                    POST-PROCESSING ANALYSIS                             │
    │                                                                         │
    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
    │  │     Hybrid      │  │     Cluster     │  │    Hotspot      │        │
    │  │   Detection     │  │    Analysis     │  │ Identification  │        │
    │  │   (Class 9)     │  │   (Class 10)    │  │                 │        │
    │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │
    │                                                                         │
    │            Advanced Pattern Recognition                                  │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │ Complete Analysis
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                         OUTPUT LAYER                                    │
    │                                                                         │
    │ ┌───────────────────────────────────────────────────────────────────┐   │
    │ │                        EXPORT FORMATS                            │   │
    │ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐     │   │
    │ │ │   BED   │ │ BigWig  │ │   CSV   │ │  Excel  │ │  JSON   │     │   │
    │ │ │ Tracks  │ │ Tracks  │ │  Data   │ │ Reports │ │   API   │ ... │   │
    │ │ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘     │   │
    │ └───────────────────────────────────────────────────────────────────┘   │
    │                                                                         │
    │ ┌───────────────────────────────────────────────────────────────────┐   │
    │ │                      VISUALIZATIONS                              │   │
    │ │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐     │   │
    │ │ │ Basic   │ │Interactive│Statistical│ Genomic │ │Advanced │     │   │
    │ │ │ Charts  │ │  Plots   │ Analysis  │ Mapping │ │Analysis │ ... │   │
    │ │ │ (4 types│ │(4 types) │(5 types)  │(4 types)│ │(4 types)│     │   │
    │ │ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘     │   │
    │ └───────────────────────────────────────────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────────────────┘
```

## Detailed Class Detection Workflow

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                        Class-Specific Detection Flow                        ║
╚══════════════════════════════════════════════════════════════════════════════╝

                            ┌─────────────────┐
                            │  Hyperscan      │
                            │  Raw Matches    │
                            └─────────┬───────┘
                                      │
                     ┌────────────────┼────────────────┐
                     │                │                │
           ┌─────────▼─────────┐ ┌────▼────┐ ┌─────────▼─────────┐
           │    Class 1-5      │ │Class 6  │ │    Class 7-8      │
           │   Single-step     │ │G-Quad   │ │   Multi-step      │
           │   Detection       │ │(Complex)│ │   Refinement      │
           └─────────┬─────────┘ └────┬────┘ └─────────┬─────────┘
                     │                │                │
                     ▼                ▼                ▼
           ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
           │ Direct Scoring  │ │ Multi-subclass  │ │ Algorithm-      │
           │ & Validation    │ │ Classification  │ │ specific        │
           │                 │ │                 │ │ Validation      │
           └─────────┬───────┘ └─────────┬───────┘ └─────────┬───────┘
                     │                   │                   │
                     └───────────────────┼───────────────────┘
                                         │
                                ┌────────▼────────┐
                                │  Standardized   │
                                │     Motifs      │
                                └─────────────────┘
```

## G-Quadruplex Multi-Subclass Detection

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                    G-Quadruplex Detection (Class 6)                         ║
╚══════════════════════════════════════════════════════════════════════════════╝

                    ┌─────────────────────────────────────┐
                    │         G-rich Patterns             │
                    │      (Hyperscan Matches)            │
                    └─────────────────┬───────────────────┘
                                      │
            ┌─────────────────────────┼─────────────────────────┐
            │                         │                         │
   ┌────────▼────────┐     ┌─────────▼─────────┐     ┌────────▼────────┐
   │   Perfect G4    │     │    Relaxed G4     │     │   Complex G4    │
   │  (3+ G-runs)    │     │   (2+ G-runs)     │     │  (Bulged/etc)   │
   └────────┬────────┘     └─────────┬─────────┘     └────────┬────────┘
            │                        │                        │
            ▼                        ▼                        ▼
   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
   │ Canonical G4    │      │  Relaxed G4     │      │   Bulged G4     │
   │ (6.1)          │      │  (6.2)          │      │   (6.3)         │
   └─────────────────┘      └─────────────────┘      └─────────────────┘
   
   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
   │ Bipartite G4    │      │ Multimeric G4   │      │ Imperfect G4    │
   │ (6.4)          │      │ (6.5)           │      │ (6.6)           │
   └─────────────────┘      └─────────────────┘      └─────────────────┘
   
                            ┌─────────────────┐
                            │ G-Triplex       │
                            │ (6.7)           │
                            └─────────────────┘
```

## Scoring Algorithm Architecture

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                           Scoring Architecture                              ║
╚══════════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────────────────┐
    │                      MOTIF CLASS ROUTING                                │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │
      ┌───────┬───────┬───────┼───────┬───────┬───────┬───────┬───────┐
      │       │       │       │       │       │       │       │       │
      ▼       ▼       ▼       ▼       ▼       ▼       ▼       ▼       ▼
┌─────────┐ ┌───┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐
│G4Hunter │ │Crv│ │Slip │ │RLFS │ │Tplx │ │iMtf │ │Z-Sk │ │Hybr │ │Clst │
│Algorithm│ │Alg│ │Alg  │ │Det  │ │Alg  │ │Alg  │ │Alg  │ │Det  │ │Det  │
└────┬────┘ └─┬─┘ └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘
     │        │      │       │       │       │       │       │       │
     ▼        ▼      ▼       ▼       ▼       ▼       ▼       ▼       ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SCORE NORMALIZATION                                  │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │ Linear  │  │Sigmoid  │  │Length-  │  │Energy-  │  │Context- │          │
│  │ [0,1]   │  │ [0,1]   │  │Adjusted │  │ Based   │  │Dependent│          │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘          │
└─────────────────────────┬───────────────────────────────────────────────────┘
                          │
                          ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                   STANDARDIZED SCORES                                   │
    │                    (All in [0,1] range)                                 │
    └─────────────────────────────────────────────────────────────────────────┘
```

## Performance Optimization Flow

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                        Performance Optimization                             ║
╚══════════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────────────────┐
    │                         INPUT OPTIMIZATION                              │
    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
    │  │   Sequence  │  │    Batch    │  │   Memory    │  │   Cache     │    │
    │  │ Validation  │  │   Sizing    │  │   Management│  │   Strategy  │    │
    │  │             │  │             │  │             │  │             │    │
    │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                      HYPERSCAN OPTIMIZATION                             │
    │                                                                         │
    │  ┌─────────────────────────────────────────────────────────────────┐    │
    │  │                Pattern Database Caching                        │    │
    │  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐      │    │
    │  │  │    LRU    │ │  Priority │ │  Memory   │ │   SIMD    │      │    │
    │  │  │   Cache   │ │  Ordering │ │  Mapping  │ │Vectorized │      │    │
    │  │  └───────────┘ └───────────┘ └───────────┘ └───────────┘      │    │
    │  └─────────────────────────────────────────────────────────────────┘    │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                     PARALLEL PROCESSING                                 │
    │                                                                         │
    │           ┌─────────────────────────────────────────────────┐           │
    │           │              Worker Pool                        │           │
    │           │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐│           │
    │           │  │Worker 1 │ │Worker 2 │ │Worker 3 │ │Worker N ││           │
    │           │  │Class1-2 │ │Class3-4 │ │Class5-6 │ │Class7-8 ││           │
    │           │  └─────────┘ └─────────┘ └─────────┘ └─────────┘│           │
    │           └─────────────────────────────────────────────────┘           │
    │                                                                         │
    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
    │  │    Load     │  │   Dynamic   │  │    Error    │  │  Resource   │    │
    │  │ Balancing   │  │ Scheduling  │  │   Recovery  │  │ Monitoring  │    │
    │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
    └─────────────────────────┬───────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                      MEMORY OPTIMIZATION                                │
    │                                                                         │
    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
    │  │  Streaming  │  │   Garbage   │  │   Buffer    │  │ Progressive │    │
    │  │   Mode      │  │ Collection  │  │ Management  │  │   Output    │    │
    │  │             │  │             │  │             │  │             │    │
    │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
    └─────────────────────────────────────────────────────────────────────────┘
```

## Interface Architecture

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          Interface Architecture                             ║
╚══════════════════════════════════════════════════════════════════════════════╝

                    ┌─────────────────────────────────────┐
                    │             USER LAYER              │
                    └─────────────────┬───────────────────┘
                                      │
         ┌────────────────────────────┼────────────────────────────┐
         │                            │                            │
    ┌────▼────┐              ┌────────▼────────┐           ┌──────▼──────┐
    │ Web UI  │              │   REST API      │           │ Python API  │
    │ :8501   │              │   :8000         │           │ (Direct)    │
    └────┬────┘              └────────┬────────┘           └──────┬──────┘
         │                            │                           │
    ┌────▼────┐              ┌────────▼────────┐           ┌──────▼──────┐
    │Streamlit│              │    FastAPI      │           │   Module    │
    │Interface│              │    Server       │           │   Import    │
    └────┬────┘              └────────┬────────┘           └──────┬──────┘
         │                            │                           │
         │                            │                           │
         └────────────────────────────┼───────────────────────────┘
                                      │
                    ┌─────────────────▼───────────────────┐
                    │          CORE ENGINE                │
                    │                                     │
                    │  ┌─────────────────────────────┐    │
                    │  │  all_motifs_refactored()    │    │
                    │  │                             │    │
                    │  │  ┌─────┐ ┌─────┐ ┌─────┐   │    │
                    │  │  │ HS  │ │Detct│ │Score│   │    │
                    │  │  │ Eng │ │ or  │ │ Eng │   │    │
                    │  │  └─────┘ └─────┘ └─────┘   │    │
                    │  └─────────────────────────────┘    │
                    └─────────────────────────────────────┘
```

This visual documentation provides comprehensive flow diagrams and architectural representations of the NBDFinder system, complementing the detailed technical documentation already created.